**constexpr** — это ключевое слово в C++, указывающее на то, что значение выражения или результат функции могут быть вычислены на этапе компиляции.

Это позволяет использовать результат там, где требуются константные выражения (например, размеры массивов или параметры шаблонов), и повышает производительность, избавляя от вычислений во время выполнения программы.

```cpp
#include <iostream>

// Функция может быть вычислена в момент компиляции
constexpr int square(int x) {
    return x * x;
}

int main() {
    // Вычисляется компилятором
    constexpr int result = square(5); 
    
    // Использование в качестве размера массива
    int arr[square(3)]; // массив на 9 элементов
    
    std::cout << "Result: " << result;
    return 0;
}
```

Используйте код с осторожностью.

Основные особенности

1. **Обязательность инициализации**: Переменная `constexpr` должна быть инициализирована сразу.
2. **Константность**: Любой объект `constexpr` автоматически является `const`.
3. **Двойное назначение функций**: Если аргументы функции `constexpr` не являются константами времени компиляции, функция выполнится в обычном режиме (в рантайме).
4. **Требования к типам**: Типы данных должны быть «литеральными» (простые типы, такие как `int`, `double`, или структуры с constexpr-конструктором).

Особенности и ограничения (до C++20/23)

- **Локальные переменные**: Внутри функций `constexpr` (начиная с C++14) можно использовать циклы и локальные переменные, но нельзя использовать `static` или `thread_local`.
- **Виртуальные функции**: До C++20 виртуальные функции не могли быть `constexpr`. Теперь это разрешено.
- **Динамическая память**: До C++20 нельзя было использовать `new/delete` внутри `constexpr`. В современных стандартах (C++20+) разрешена временная аллокация памяти (например, `std::vector` или `std::string` внутри constexpr-контекста), если память освобождается до завершения компиляции.
- **std::is_constant_evaluated()**: Начиная с C++20, внутри функции можно проверить, выполняется ли она компилятором или в рантайме, чтобы выбрать более эффективный алгоритм.

Разница между const и constexpr

- **const**: Обещает, что значение не изменится после инициализации. Инициализация может произойти в рантайме (например, значением из ввода пользователя).
- **constexpr**: Гарантирует, что значение будет известно уже при сборке программы. Любой `constexpr` — это `const`, но не любой `const` — это `constexpr`.