Спецификатор `consteval` (появился в C++20) — это способ заставить функцию выполняться **только** на этапе компиляции. Если `constexpr` — это «могу в compile-time, а могу и в runtime», то `consteval` — это *только compile-time или никак*.

Такие функции называют *непосредственными функциями* (immediate functions).

Любой вызов `consteval`-функции должен приводить к созданию константы времени компиляции. Если компилятор не может вычислить значение на месте, он выдаст ошибку.

```cpp
#include <iostream>

// Эта функция ВСЕГДА выполняется при компиляции
consteval int square(int n) {
    return n * n;
}

int main() {
    constexpr int a = square(5); // Ок
    int b = square(10);          // Ок, результат вычислен заранее и вставлен как число 100
    
    int x = 5;
    // int c = square(x);        // ОШИБКА! 'x' не является константой времени компиляции
}
```

Особенности и нюансы
1. **Замена макросам:** `consteval` гораздо безопаснее и удобнее сложных препроцессорных макросов, так как это обычная типизированная функция.
2. **Строгость:** В отличие от `constexpr`, `consteval` нельзя вызвать с аргументами, которые станут известны только при выполнении программы (runtime).
3. **Совместимость с constexpr:** `consteval` функция может вызывать другие `consteval` или `constexpr` функции, но не наоборот (обычная `constexpr` функция не может вызвать `consteval` в runtime-контексте).
4. **Указатели:** Нельзя взять адрес `consteval` функции в runtime.

**Цепочка вызовов**
Если вы вызываете `consteval` функцию внутри другой функции, внешняя тоже должна быть `consteval` или значение должно быть известно заранее:

```cpp
consteval int f(int n) { return n; }

constexpr int g(int n) {
    // return f(n); // ОШИБКА: n в constexpr функции может быть неизвестен в compile-time
    if (std::is_constant_evaluated()) { // Или через if consteval (C++23)
         // ...
    }
    return n;
}
```

Когда использовать?
- Когда вам критически важно, чтобы вычисления не нагружали процессор пользователя (например, генерация хэшей строк, сложные математические таблицы).
- Когда функция используется для проверки параметров шаблонов или других compile-time ограничений.

`consteval` — это жесткая гарантия того, что в итоговом бинарном коде вместо вызова функции будет подставлено готовое значение.