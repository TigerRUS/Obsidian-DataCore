**Протокол MESI** — это механизм, обеспечивающий согласованность (когерентность) данных между кэшами разных ядер процессора. Он гарантирует, что если одно ядро изменило данные, остальные ядра об этом узнают и не будут использовать устаревшие значения. 

Название MESI — это аббревиатура четырех состояний, в которых может находиться каждая **кэш-линия** (блок данных, обычно 64 байта): 

Состояния протокола
- **M (Modified) — Изменена:**  
    Данные изменены ядром и присутствуют *только в его кэше*. Они отличаются от данных в основной памяти (RAM). Прежде чем другое ядро сможет их прочитать, они должны быть записаны обратно в память или переданы напрямую.
- **E (Exclusive) — Эксклюзивна:**  
    Данные идентичны памяти и находятся *только в кэше этого ядра*. Это чистая копия: ядро может изменить её без уведомления других, мгновенно переведя в состояние **Modified**.
- **S (Shared) — Разделяемая:**  
    *Данные идентичны памяти и могут находиться в кэшах нескольких ядер одновременно* Если одно ядро захочет записать данные в эту линию, оно обязано отправить сигнал аннулирования (**Invalidate**) всем остальным.
- **I (Invalid) — Невалидна:**  
    Данные в этой кэш-линии неактуальны или отсутствуют. При попытке чтения из такого состояния произойдет кэш-промах (*cache miss*), и данные будут загружены заново. 

Как это работает в динамике
1. **Ядро А** читает данные из RAM. Линия переходит в состояние **Exclusive (E)**.
2. **Ядро Б** читает те же данные. Протокол видит это и переводит линию в обоих ядрах в состояние **Shared (S)**.
3. **Ядро А** решает изменить значение. Оно отправляет по шине сигнал аннулирования. У **Ядра Б** состояние линии становится **Invalid (I)**, а у **Ядра А** — **Modified (M)**.
4. Если **Ядро Б** теперь захочет прочитать это значение, оно увидит статус **Invalid**, запросит обновление и получит свежие данные от **Ядра А**. 

Связь с False Sharing
Проблема [[False sharing]] возникает именно из-за агрессивной работы MESI. Когда два ядра пишут в разные переменные на одной линии, протокол видит это как запись в одну и ту же область памяти. В итоге ядра бесконечно передают кэш-линию друг другу, переводя её из **Modified** в **Invalid** и обратно десятки тысяч раз в секунду, что парализует работу процессора. 

Развитие (MOESI)
В современных процессорах (например, AMD) часто используется расширенный протокол **MOESI**, где добавлено состояние **Owned** (Владение). Оно позволяет ядрам делиться измененными данными напрямую друг с другом без немедленной записи в медленную оперативную память.